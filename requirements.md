# Workshop AI Narration App  
## 機能要件定義（Functional Requirements）

---

## 1. 背景・目的

本アプリは、医師会・地域研修等における  
**新興感染症対応ワークショップ（60分）**を円滑に実施するための  
**講師専用支援アプリ**である。

参加者がホワイトボードにまとめた議論内容を、  
講師が撮影・アップロードし、  
AIが解析・要約・音声化することで、

- 講師の負担を軽減する
- グループ間の知見を公平に共有する
- 研修の質と再現性を高める

ことを目的とする。

---

## 2. 想定利用シナリオ

- 利用者：研修講師（1名）
- 参加者：3〜4グループ（各4〜5名）
- 研修時間：60分
- デバイス：
  - 講師：スマートフォン／タブレット／PC
  - 参加者：不要（アプリ非利用）

---

## 3. アプリの基本方針

- 講師単独操作（参加者UIなし）
- 完全非同期・並列処理
- 失敗しても研修が止まらない設計
- 認証なし（PoC / 限定利用前提）
- 個人情報・患者情報を扱わない

---

## 4. 機能一覧（概要）

| 機能カテゴリ | 内容 |
|---|---|
| 撮影・アップロード | 講師が写真を撮影しAI解析ジョブを作成 |
| ジョブ管理 | 各グループの解析進捗を一覧表示 |
| AI解析 | 画像→テキスト→要約（4フェーズ整理） |
| 音声生成 | 要約テキストを音声化 |
| 再生 | 完了したグループから音声再生 |
| リアルタイム更新 | WebSocketによる状態更新 |
| リトライ | 解析・音声生成の再試行 |

---

## 5. 詳細機能要件

### 5.1 撮影・アップロード機能

- 講師が端末のカメラでホワイトボードを撮影できること
- 画像アップロード時に以下を送信すること
  - 画像ファイル
  - group_id（A, B, C, D…）
  - workshop_id（当日固定）
- アップロード後、即時に完了通知を返すこと
- 解析完了を待たず、連続アップロード可能であること

#### 非要件
- 画像の保存・閲覧履歴の永続化は行わない

---

### 5.2 ジョブ管理・進捗表示

- 画像1枚を1ジョブとして管理する
- 各ジョブは以下の状態を持つこと
  - uploaded
  - analyzing
  - narrating
  - done
  - error
- 講師画面で全グループの状態を一覧表示できること
- 完了した順に再生可能であること

---

### 5.3 AI解析機能（バックエンド要件）

- ホワイトボード画像を入力として受け取る
- 以下を行うこと
  1. 手書き文字の認識（OCR）
  2. 内容の意味解析
  3. 以下4カテゴリへの整理
     - 疑う
     - 分ける
     - 守る
     - つなぐ
- 正誤判定や評価は行わない
- 肯定的・中立的なトーンで要約する

---

### 5.4 音声生成機能

- AI解析で生成された要約テキストを音声化する
- 要件：
  - 日本語
  - 医師会研修向けの落ち着いた音声
  - 再生時間：45〜60秒
- 音声形式：
  - MP3 または WAV
- 音声URLを生成し、クライアントから再生可能とする

---

### 5.5 音声再生機能（講師画面）

- 完了（done）状態のジョブのみ再生可能
- 再生時に以下を表示
  - グループ名
  - 要約テキスト（参考表示）
  - 音声プレイヤー
- 同時に複数音声を再生しない（1つずつ）

---

### 5.6 リアルタイム更新（WebSocket）

- WebSocketにより以下をPush配信する
  - ワークショップ開始時のジョブ一覧（snapshot）
  - 各ジョブの状態更新（job_update）
- クライアントはポーリングを行わない
- 切断時は自動再接続すること

---

### 5.7 再試行（Retry）機能

- error 状態のジョブに対して再試行可能
- 再試行の種類
  - 解析から再実行
  - 音声生成のみ再実行
- 再試行中も他ジョブに影響を与えない

---

## 6. UI/UX要件（講師画面）

- 一画面で以下を確認・操作できること
  - 撮影・アップロード
  - グループ別進捗一覧
  - 音声再生
- 押せないボタンは押せない状態で表示
- 研修進行を妨げないシンプルなUI

---

## 7. 非機能要件

### 7.1 性能・可用性

- 同時3〜4ジョブの並列処理に耐える
- 1ジョブ失敗が全体に影響しない
- 研修中に画面がフリーズしない

### 7.2 セキュリティ・倫理

- 患者名・施設名を扱わない前提
- 画像・解析結果は一定時間後に削除可能
- 医療行為・診断支援ではないことを明示

### 7.3 拡張性

- 将来的に以下を追加可能な設計とする
  - 認証
  - 研修履歴保存
  - e-learning化
  - 多言語対応

---

## 8. 技術スタック（前提）

- フロントエンド：Next.js（App Router）
- 通信：
  - REST API（結果取得・再試行）
  - WebSocket（状態更新）
- AI：
  - 画像解析（Vision）
  - 言語モデル（要約）
  - Text-to-Speech（音声生成）

---

## 9. 成功条件（Acceptance Criteria）

- 60分研修内で
  - 3〜4グループの写真をアップロードできる
  - 解析・音声生成が並行して進む
  - 完了した順に音声解説を再生できる
- 講師が一人で操作可能
- 参加者の議論を妨げない

---

## 10. 本要件定義の位置づけ

本ドキュメントは、

- 人間開発者
- AIエージェント
- 外注先

に対して **実装を委任するための正式な機能要件定義**とする。

設計・実装上の裁量は認めるが、  
**本要件を満たすことを最低条件**とする。